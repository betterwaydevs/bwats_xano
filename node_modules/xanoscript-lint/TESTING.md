# Testing the XanoScript LSP CLI

## Setup for Testing in Your XanoScript Projects

### Method 1: Global Link (Best for Development)

The CLI has already been linked globally! You can now use it in any XanoScript project.

```bash
# Go to your XanoScript project
cd /path/to/your/xanoscript-project

# Run the CLI
xs-lint

# Or use specific options
xs-lint --json
xs-lint "src/**/*.xs"
```

### Method 2: Direct Path (No Installation)

You can run the CLI directly without installing:

```bash
# From your XanoScript project directory
node /Users/danielpetro/Documents/GitHub/xano-lsp-cli/bin/xs-lint.js

# Or add an alias to your shell:
alias xs-lint='node /Users/danielpetro/Documents/GitHub/xano-lsp-cli/bin/xs-lint.js'
```

### Method 3: Copy .claude Command Only

If you just want the Claude Code integration:

```bash
# In your XanoScript project
mkdir -p .claude/commands

# Copy the slash command
cp /Users/danielpetro/Documents/GitHub/xano-lsp-cli/.claude/commands/xs-lint.md .claude/commands/

# Update the command to use the direct path
# Edit .claude/commands/xs-lint.md and replace:
# node bin/xs-lint.js
# with:
# node /Users/danielpetro/Documents/GitHub/xano-lsp-cli/bin/xs-lint.js
```

## Testing with Claude Code

### 1. In This Repository

Open Claude Code in this directory and try:
```
/xs-lint test/example.xs
```

### 2. In Your XanoScript Project

**Option A - If you copied the .claude command:**
```
/xs-lint
```

**Option B - Ask Claude directly:**
```
Use the xs-lint CLI at /Users/danielpetro/Documents/GitHub/xano-lsp-cli/bin/xs-lint.js
to validate all .xs files and fix any issues
```

## Verification Steps

### 1. Check the CLI is linked
```bash
which xs-lint
# Should output: /Users/danielpetro/Documents/GitHub/xano-lsp-cli/bin/xs-lint.js

xs-lint --help
# Should show the help message
```

### 2. Test in a XanoScript project
```bash
# Navigate to your XanoScript project
cd /path/to/your/xanoscript-project

# Validate all .xs files
xs-lint

# Expected output if files are valid:
# âœ… No issues found!
#    Checked X files

# Expected output if files have errors:
# filename.xs:
#   âŒ Line X:Y - Error message
#
# ðŸ“Š Summary:
#    Files checked: X
#    Files with issues: Y
#    âŒ Errors: Z
```

### 3. Test JSON output
```bash
xs-lint --json > lint-results.json
cat lint-results.json
```

### 4. Test with Claude Code

In your XanoScript project with Claude Code:

1. Open Claude Code
2. Type: `/xs-lint`
3. Claude will:
   - Run diagnostics on your .xs files
   - Show you any errors
   - Offer to fix them
   - Re-validate after fixes

## Troubleshooting

### "xs-lint: command not found"

The global link might not be in your PATH. Use the direct path instead:
```bash
node /Users/danielpetro/Documents/GitHub/xano-lsp-cli/bin/xs-lint.js
```

### "XanoScript extension not found"

Make sure you have the XanoScript VS Code extension installed:
```bash
code --list-extensions | grep xano
# Should show: xano.xanoscript@X.X.X
```

If not installed:
```bash
code --install-extension xano.xanoscript
```

### LSP Server Not Starting

Check if the server file exists:
```bash
ls ~/.vscode/extensions/xano.xanoscript-*/dist/server.js
```

If the file doesn't exist, reinstall the XanoScript extension in VS Code.

### Claude Code Not Finding /xs-lint

Make sure the `.claude/commands/xs-lint.md` file exists in your project:
```bash
ls -la .claude/commands/xs-lint.md
```

If it doesn't exist, copy it from this repository or create it with:
```bash
mkdir -p .claude/commands
cp /Users/danielpetro/Documents/GitHub/xano-lsp-cli/.claude/commands/xs-lint.md .claude/commands/
```

## Example Test Project

Want to create a quick test? Here's a minimal XanoScript project:

```bash
# Create test project
mkdir ~/xanoscript-test
cd ~/xanoscript-test

# Create a valid .xs file
cat > users.xs << 'EOF'
query GET /users {
  description "Get all users"

  response {
    users: []
  }
}
EOF

# Create an invalid .xs file
cat > invalid.xs << 'EOF'
query invalid_syntax {
  this is not valid xanoscript
}
EOF

# Test the CLI
xs-lint

# Expected output:
# invalid.xs:
#   âŒ Line X:Y - [error message]
#
# ðŸ“Š Summary:
#    Files checked: 2
#    Files with issues: 1
#    âŒ Errors: 1
```

## Integration Testing

### CI/CD Integration
```bash
# Add to your CI pipeline (e.g., GitHub Actions)
xs-lint || exit 1
```

### Pre-commit Hook
```bash
# .git/hooks/pre-commit
#!/bin/bash
xs-lint --quiet
if [ $? -ne 0 ]; then
  echo "XanoScript validation failed. Please fix errors before committing."
  exit 1
fi
```

Make it executable:
```bash
chmod +x .git/hooks/pre-commit
```

## Performance Testing

Test with large projects:
```bash
# Time the validation
time xs-lint

# Check with specific pattern
time xs-lint "src/**/*.xs"

# Compare JSON vs readable output
time xs-lint --quiet > /dev/null
time xs-lint --json --quiet > /dev/null
```

## Uninstalling

If you need to unlink:
```bash
npm unlink -g xanoscript-lint
```

## Getting Help

If you encounter issues:
1. Check this troubleshooting guide
2. Review the main [README.md](README.md)
3. Check the LSP server logs (stderr output)
4. Open an issue on GitHub
