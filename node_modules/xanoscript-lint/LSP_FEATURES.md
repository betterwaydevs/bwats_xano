# XanoScript LSP Features

The CLI now provides **full access** to the XanoScript Language Server features!

## Available Commands

### 1. `xs-lint` - Validation & Diagnostics
Get errors, warnings, and syntax issues.

```bash
xs-lint file.xs --json
```

Uses: `onDidChangeContent/` from LSP

> Automation tip: pipe newline-separated file paths into `xs-lint --json --stdin` so Claude can reuse a single approved command signature.

### 2. `xs-complete` - Code Completions
Get available completions at cursor position.

```bash
xs-complete file.xs --line 10 --column 5 --json
```

Uses: `onCompletion/` from LSP

### 3. `xs-hover` - Documentation & Types
Get hover information, documentation, and type details.

```bash
xs-hover file.xs --line 10 --column 5 --json
```

Uses: `onHover/` from LSP

### 4. `xs-setup` - Claude Code Integration
Automatically install skill and commands.

```bash
xs-setup
```

## LSP Features Explained

### What Each LSP Feature Does

From the XanoScript extension:

| LSP Feature | CLI Command | What It Does | Claude Code Use Case |
|-------------|-------------|--------------|----------------------|
| `onDidChangeContent` | `xs-lint` | Validates syntax, returns errors | Automatic validation after edits |
| `onCompletion` | `xs-complete` | Suggests what you can type | Smart autocomplete suggestions |
| `onHover` | `xs-hover` | Shows documentation for symbols | Understand what functions/fields are |
| `onSemanticCheck` | (not exposed) | Syntax highlighting | VS Code only |

## How Claude Code Uses These

### Scenario 1: Fixing an Error

```
User has error at line 12: "Unexpected token"

Claude workflow:
1. xs-lint file.xs --json
   â†’ Gets: Error at line 12, column 5

2. xs-hover file.xs --line 11 --column 4 --json
   â†’ Gets: "This is the 'input' block - expects field: type format"
   â†’ Now Claude understands the context!

3. Fixes the error with proper syntax

4. xs-lint file.xs --json
   â†’ Confirms: No errors
```

### Scenario 2: Writing New Code

```
User: "Add pagination to this endpoint"

Claude workflow:
1. Reads the file to find where to add code

2. xs-complete file.xs --line 15 --column 10 --json
   â†’ Gets: Available fields/functions at this position
   â†’ Suggests: limit, offset, etc.

3. Writes the code using valid completions

4. xs-lint file.xs --json
   â†’ Auto-validates the new code
```

### Scenario 3: Understanding Existing Code

```
User: "What does this function do?"

Claude workflow:
1. xs-hover file.xs --line 20 --column 15 --json
   â†’ Gets: Function documentation
   â†’ Returns: "db.query() - Queries database table with filters..."

2. Explains to user with full context
```

## Example Outputs

### xs-lint Output
```json
{
  "summary": {
    "totalErrors": 1,
    "hasErrors": true
  },
  "results": [{
    "file": "test.xs",
    "diagnostics": [{
      "line": 12,
      "column": 5,
      "message": "Expecting --> ':' <--",
      "severity": "error"
    }]
  }]
}
```

### xs-complete Output
```json
{
  "items": [
    {
      "label": "limit",
      "kind": 10,
      "detail": "number",
      "documentation": "Maximum number of results to return"
    },
    {
      "label": "offset",
      "kind": 10,
      "detail": "number",
      "documentation": "Number of results to skip"
    }
  ]
}
```

### xs-hover Output
```json
{
  "contents": {
    "kind": "markdown",
    "value": "```xanoscript\ndb.query(table: string)\n```\n\nQueries the database table with optional filters and sorting."
  },
  "range": {
    "start": { "line": 10, "character": 5 },
    "end": { "line": 10, "character": 13 }
  }
}
```

## Integration with Claude Code Skill

The skill automatically uses all three commands:

1. **After every file edit**: Runs `xs-lint` for validation
2. **When fixing errors**: Uses `xs-hover` to understand context
3. **When writing new code**: Uses `xs-complete` for suggestions (optional)

This makes Claude Code much smarter when working with XanoScript!

## Benefits

### Before (Only Validation)
- âŒ Claude could only see errors
- âŒ Had to guess what's valid
- âŒ No context about symbols
- âŒ Limited to error messages

### After (Full LSP Access)
- âœ… See errors AND get diagnostics
- âœ… Know what's valid to type (completions)
- âœ… Understand what symbols mean (hover)
- âœ… Rich context for better fixes

## Testing the Features

```bash
# 1. Validation
xs-lint test/example.xs --json

# 2. Completions at a position
xs-complete test/example.xs --line 5 --column 10 --json

# 3. Hover info at a position
xs-hover test/example.xs --line 3 --column 8 --json
```

## Future Enhancements

Other LSP features that could be added:
- `textDocument/definition` - Go to definition
- `textDocument/references` - Find references
- `textDocument/formatting` - Format document
- `textDocument/codeAction` - Quick fixes

Let me know if you want any of these added!

## Summary

**We now use THREE LSP features:**

1. âœ… **onDidChangeContent** â†’ `xs-lint` (validation)
2. âœ… **onCompletion** â†’ `xs-complete` (completions)
3. âœ… **onHover** â†’ `xs-hover` (documentation)

All accessible via simple CLI commands that Claude Code can use automatically! ðŸŽ‰
