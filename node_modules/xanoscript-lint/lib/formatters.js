/**
 * Output formatters for XanoScript validation results
 */

/**
 * Format results as human-readable text
 */
export function formatHumanReadable(results, summary) {
  const lines = [];

  if (results.length === 0) {
    lines.push('No files to validate');
    return lines.join('\n');
  }

  // Show results for each file with issues
  const filesWithIssues = results.filter(r => r.errorCount > 0 || r.warningCount > 0 || r.error);

  if (filesWithIssues.length === 0) {
    lines.push('‚úÖ No issues found!');
    lines.push(`   Checked ${summary.totalFiles} file${summary.totalFiles !== 1 ? 's' : ''}`);
    return lines.join('\n');
  }

  lines.push('');

  for (const fileResult of filesWithIssues) {
    lines.push(`\n${fileResult.file}:`);

    // Show file-level error if exists
    if (fileResult.error) {
      lines.push(`  ‚ùå Error: ${fileResult.error}`);
      continue;
    }

    // Show each diagnostic
    for (const diag of fileResult.diagnostics) {
      const icon = getSeverityIcon(diag.severity);
      const location = `Line ${diag.line}:${diag.column}`;
      lines.push(`  ${icon} ${location} - ${diag.message}`);

      // Show source if available
      if (diag.code) {
        lines.push(`     Code: ${diag.code}`);
      }
    }
  }

  // Summary
  lines.push('\n' + '‚îÄ'.repeat(60));
  lines.push(`üìä Summary:`);
  lines.push(`   Files checked: ${summary.totalFiles}`);
  lines.push(`   Files with issues: ${summary.filesWithIssues}`);

  if (summary.totalErrors > 0) {
    lines.push(`   ‚ùå Errors: ${summary.totalErrors}`);
  }

  if (summary.totalWarnings > 0) {
    lines.push(`   ‚ö†Ô∏è  Warnings: ${summary.totalWarnings}`);
  }

  if (summary.totalInfo > 0) {
    lines.push(`   ‚ÑπÔ∏è  Info: ${summary.totalInfo}`);
  }

  lines.push('');

  return lines.join('\n');
}

/**
 * Format results as JSON
 */
export function formatJSON(results, summary) {
  return JSON.stringify({
    summary,
    results
  }, null, 2);
}

/**
 * Format results as compact JSON (single line per file)
 */
export function formatCompactJSON(results, summary) {
  return JSON.stringify({
    summary,
    results
  });
}

/**
 * Get severity icon for human-readable output
 */
function getSeverityIcon(severity) {
  switch (severity) {
    case 'error': return '‚ùå';
    case 'warning': return '‚ö†Ô∏è ';
    case 'info': return '‚ÑπÔ∏è ';
    case 'hint': return 'üí°';
    default: return '‚Ä¢';
  }
}

/**
 * Format a single file result for streaming output
 */
export function formatFileProgress(filePath, index, total) {
  const percentage = Math.round((index / total) * 100);
  return `[${percentage}%] Checking ${filePath}...`;
}
